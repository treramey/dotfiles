#!/bin/bash

set -eufo pipefail

{{ $official := list
    "autoconf"
    "automake"
    "base"
    "base-devel"
    "docker"
    "gettext"
    "git"
    "inetutils"
    "less"
    "linux"
    "make"
    "ncdu"
    "neofetch"
    "neovim"
    "openssh"
    "pkgconf"
    "python"
    "rustup"
    "sudo"
    "tailscale"
    "unzip"
    "wget"
    "zip"
    "zsh" -}}
{{ $aur := list
    "7zip"
    "air-bin"
    "arp-scan"
    "autojump-rs"
    "aws-cli-v2-bin"
    "aws-session-manager-plugin"
    "awslogs"
    "bat"
    "bind"
    "btop"
    "bun-bin"
    "cloudflared"
    "cmake"
    "composer"
    "consolas-font"
    "cronie"
    "direnv"
    "dmidecode"
    "dmraid"
    "docker-compose"
    "downgrade"
    "esbuild"
    "elixir"
    "exfat-utils"
    "fd"
    "ffmpeg"
    "ffmpegthumbnailer"
    "fnm"
    "fuse-overlayfs"
    "fzf"
    "git-delta"
    "github-cli"
    "gitwatch-git"
    "gleam"
    "gnu-netcat"
    "go"
    "goreleaser"
    "hyperfine"
    "imagemagick"
    "iperf3"
    "iw"
    "iwd"
    "jq"
    "julia"
    "just"
    "lazygit"
    "libaio"
    "libldm"
    "linux-firmware"
    "lsof"
    "mariadb-clients"
    "mitmproxy"
    "mono"
    "mysql-clients"
    "nfs-utils"
    "ngrok"
    "ninja"
    "nmap"
    "noto-fonts-emoji"
    "nushell"
    "paru-bin"
    "plow"
    "pnpm"
    "poppler"
    "postgresql"
    "prettierd"
    "pscale-cli-bin"
    "pspg"
    "pv"
    "python-pynvim"
    "reflector"
    "ripgrep"
    "rsync"
    "speedtest-cli"
    "sshfs"
    "sshuttle"
    "sst-bin"
    "starship"
    "stow"
    "syncthing"
    "sysbench"
    "terraform"
    "traceroute"
    "typescript"
    "unison"
    "unrar"
    "uv"
    "vercel"
    "xclip"
    "yazi"
    "yt-dlp"
    "zellij"
    "zoxide"
    "zsh-syntax-highlighting-git" -}}

PKGLIST="/tmp/pkglist.$$"
trap 'rm -f "$PKGLIST"' EXIT

echo "Installing official packages..."
printf "%s\n" {{ $official | sortAlpha | uniq | join " " }} > "$PKGLIST"
sudo pacman -S --needed --asexplicit - < "$PKGLIST"

echo "Installing AUR packages..."
printf "%s\n" {{ $aur | sortAlpha | uniq | join " " }} > "$PKGLIST"
paru -S --needed --asexplicit - < "$PKGLIST"
