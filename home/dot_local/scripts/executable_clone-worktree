#!/usr/bin/env bash
set -euo pipefail

if [ $# -lt 1 ]; then
    echo "Usage: $(basename "$0") <repository-url> [directory-name]"
    exit 1
fi

url=$1
basename=${url##*/}
basename=${basename%.git} 
name=${2:-$basename}

echo "Cloning repository..."
git clone "$url"

echo "Setting up worktree..."
if [ -d "$basename/.git" ]; then
    mv "$basename/.git" "$basename.git"
    rm -rf "$basename"
    mkdir -p "$basename"
    mv "$basename.git" "$basename/.git"
    cd "$basename" || exit 1
    git config --bool core.bare true
    git fetch origin
    echo "Ready for lift-off!"
else
    echo "Error: Failed to create bare repository structure."
    exit 1
fi
